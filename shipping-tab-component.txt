// ShippingTab Component - Insert this before SettingsTab (around line 1637)

function ShippingTab({ orders, formatDate, formatCurrency, getStatusBadge }: any) {
  const [trackingNumbers, setTrackingNumbers] = useState<Record<string, string>>({})
  const [updatingOrder, setUpdatingOrder] = useState<string | null>(null)

  // Filter orders that have shipping addresses (physical products)
  const shippingOrders = orders.filter((order: any) => order.shipping_address)

  const handleUpdateTracking = async (orderId: string) => {
    const trackingNumber = trackingNumbers[orderId]
    if (!trackingNumber) {
      alert('Please enter a tracking number')
      return
    }

    setUpdatingOrder(orderId)
    try {
      await updateDoc(doc(db, 'orders', orderId), {
        tracking_number: trackingNumber,
        status: 'shipped',
        updated_at: new Date().toISOString()
      })
      
      // Update local state
      const updatedOrders = orders.map((o: any) => 
        o.id === orderId ? { ...o, tracking_number: trackingNumber, status: 'shipped' } : o
      )
      
      toast.success('Order marked as shipped!')
    } catch (error) {
      console.error('Error updating order:', error)
      toast.error('Failed to update order')
    } finally {
      setUpdatingOrder(null)
    }
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">Shipping & Fulfillment</h3>
          <p className="text-white/50 text-sm mt-1">Manage physical product orders and shipping</p>
        </div>
        <div className="px-4 py-2 rounded-xl bg-amber-500/20 border border-amber-500/30 text-amber-400 text-sm font-medium">
          {shippingOrders.filter((o: any) => o.status === 'pending' || o.status === 'processing').length} Pending
        </div>
      </div>

      {shippingOrders.length === 0 ? (
        <div className="text-center py-16 bg-white/5 rounded-2xl border border-white/10">
          <Truck size={48} className="mx-auto text-white/20 mb-4" />
          <p className="text-white/50">No shipping orders yet</p>
        </div>
      ) : (
        <div className="space-y-4">
          {shippingOrders.map((order: any) => (
            <div key={order.id} className="bg-white/5 rounded-2xl border border-white/10 p-6">
              <div className="flex items-start justify-between mb-4">
                <div>
                  <div className="flex items-center gap-3 mb-2">
                    <h4 className="font-semibold">Order #{order.id.slice(0, 8)}</h4>
                    {getStatusBadge(order.status)}
                  </div>
                  <p className="text-white/50 text-sm">{formatDate(order.created_at)}</p>
                </div>
                <div className="text-right">
                  <p className="text-white/50 text-sm">Total</p>
                  <p className="text-lg font-semibold text-cyan-400">{formatCurrency(order.total)}</p>
                </div>
              </div>

              <div className="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <p className="text-white/50 text-sm mb-1">Customer</p>
                  <p className="font-medium">{order.user_email}</p>
                </div>
                <div>
                  <p className="text-white/50 text-sm mb-1">Shipping Address</p>
                  <p className="font-medium text-sm">{order.shipping_address}</p>
                </div>
              </div>

              <div className="mb-4">
                <p className="text-white/50 text-sm mb-2">Items</p>
                <div className="space-y-2">
                  {order.items?.map((item: any, idx: number) => (
                    <div key={idx} className="flex items-center justify-between text-sm bg-white/5 rounded-lg p-2">
                      <span>{item.title}</span>
                      <span className="text-white/50">x{item.quantity}</span>
                    </div>
                  ))}
                </div>
              </div>

              {order.status !== 'shipped' && order.status !== 'delivered' && (
                <div className="flex gap-3 pt-4 border-t border-white/10">
                  <input
                    type="text"
                    placeholder="Enter tracking number"
                    value={trackingNumbers[order.id] || order.tracking_number || ''}
                    onChange={(e) => setTrackingNumbers({ ...trackingNumbers, [order.id]: e.target.value })}
                    className="flex-1 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-cyan-500/50"
                  />
                  <button
                    onClick={() => handleUpdateTracking(order.id)}
                    disabled={updatingOrder === order.id}
                    className="px-6 py-2 rounded-xl bg-cyan-500 text-white font-medium hover:bg-cyan-600 disabled:opacity-50 flex items-center gap-2"
                  >
                    {updatingOrder === order.id ? (
                      <>
                        <RefreshCw size={16} className="animate-spin" />
                        Updating...
                      </>
                    ) : (
                      <>
                        <Truck size={16} />
                        Mark as Shipped
                      </>
                    )}
                  </button>
                </div>
              )}

              {order.tracking_number && (
                <div className="mt-4 p-3 rounded-xl bg-green-500/10 border border-green-500/20">
                  <p className="text-green-400 text-sm font-medium">
                    Tracking: {order.tracking_number}
                  </p>
                </div>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  )
}
